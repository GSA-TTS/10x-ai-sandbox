{"version":3,"file":"21.fe721cad.js","sources":["../../../../../../src/routes/auth/+page.svelte"],"sourcesContent":["<script>\n\timport { goto } from '$app/navigation';\n\timport { userSignIn, userSignInOauth, userSignUp } from '$lib/apis/auths';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\timport { WEBUI_NAME, config, user, socket } from '$lib/stores';\n\timport { onMount, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport { generateInitialsImage, canvasPixelTest } from '$lib/utils';\n\n\tconst i18n = getContext('i18n');\n\n\timport { page } from '$app/stores';\n\n\tlet loaded = false;\n\tlet mode = 'signin';\n\n\tlet name = '';\n\tlet email = '';\n\tlet password = '';\n\tlet state = '';\n\tlet code = '';\n\tlet provider = '';\n\n\tconst setSessionUser = async (sessionUser) => {\n\t\tif (sessionUser) {\n\t\t\tconsole.log('sessionUser:', sessionUser);\n\t\t\ttoast.success($i18n.t(`You're now logged in.`));\n\t\t\tlocalStorage.token = sessionUser.token;\n\n\t\t\t$socket.emit('user-join', { auth: { token: sessionUser.token } });\n\t\t\tawait user.set(sessionUser);\n\t\t\tgoto('/');\n\t\t}\n\t};\n\n\tconst signInHandler = async () => {\n\t\tconst sessionUser = await userSignIn(email, password).catch((error) => {\n\t\t\ttoast.error(error); // Error handled here\n\t\t\treturn null; // sessionUser becomes null\n\t\t});\n\n\t\tif (sessionUser) {\n\t\t\t// Check if sessionUser is not null\n\t\t\tawait setSessionUser(sessionUser); // Only called if sign-in was successful\n\t\t}\n\t};\n\n\tconst signInHandlerOauth = async () => {\n\t\tconst sessionUser = await userSignInOauth(state, code, provider).catch((error) => {\n\t\t\ttoast.error(error); // Error handled here\n\t\t\tstate = '';\n\t\t\tcode = '';\n\t\t\tprovider = '';\n\t\t\tgoto('/auth');\n\t\t});\n\n\t\tif (sessionUser) {\n\t\t\t// Check if sessionUser is not null\n\t\t\tawait setSessionUser(sessionUser); // Only called if sign-in was successful\n\t\t} else {\n\t\t\tconsole.log('sessionUser does not exist');\n\t\t}\n\t};\n\n\tconst signUpHandler = async () => {\n\t\tconst sessionUser = await userSignUp(name, email, password, generateInitialsImage(name)).catch(\n\t\t\t(error) => {\n\t\t\t\ttoast.error(error); // Error handled here\n\t\t\t\treturn null; // sessionUser becomes null\n\t\t\t}\n\t\t);\n\n\t\tif (sessionUser) {\n\t\t\t// Check if sessionUser is not null\n\t\t\tawait setSessionUser(sessionUser); // Only called if sign-up was successful\n\t\t}\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (mode === 'signin') {\n\t\t\tawait signInHandler();\n\t\t} else {\n\t\t\tawait signUpHandler();\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tif ($user !== undefined) {\n\t\t\tawait goto('/');\n\t\t}\n\t\tloaded = true;\n\n\t\tconst params = $page.url.searchParams;\n\t\tif (params.has('state') && params.has('code') && params.has('provider')) {\n\t\t\tstate = params.get('state') ?? '';\n\t\t\tcode = params.get('code') ?? '';\n\t\t\tprovider = params.get('provider') ?? '';\n\t\t\tif (state && code && provider) {\n\t\t\t\tawait signInHandlerOauth();\n\t\t\t}\n\t\t}\n\n\t\tif (($config?.features.auth_trusted_header ?? false) || $config?.features.auth === false) {\n\t\t\tawait signInHandler();\n\t\t}\n\t});\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{`${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n{#if loaded}\n\t<div class=\"fixed m-10 z-50\">\n\t\t<div class=\"flex space-x-2\">\n\t\t\t<div class=\" self-center\">\n\t\t\t\t<img\n\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\tsrc=\"{WEBUI_BASE_URL}/static/favicon.png\"\n\t\t\t\t\tclass=\" w-8 rounded-full\"\n\t\t\t\t\talt=\"logo\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\" bg-white dark:bg-gray-950 min-h-screen w-full flex justify-center font-mona\">\n\t\t<div class=\"w-full sm:max-w-md px-10 min-h-screen flex flex-col text-center\">\n\t\t\t{#if code !== '' && state !== ''}\n\t\t\t\t<div class=\" my-auto pb-10 w-full\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex items-center justify-center gap-3 text-xl sm:text-2xl text-center font-medium dark:text-gray-200\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{$i18n.t('Signing in')}\n\t\t\t\t\t\t\t{$i18n.t('to')}\n\t\t\t\t\t\t\t{$WEBUI_NAME}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"  my-auto pb-10 w-full dark:text-gray-100\">\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\" flex flex-col justify-center\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\tsubmitHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"mb-1 pb-10\">\n\t\t\t\t\t\t\t<div class=\" text-2xl font-medium\">\n\t\t\t\t\t\t\t\t{$WEBUI_NAME}\n\t\t\t\t\t\t\t\t<br /><span>powered by 10x</span>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if mode === 'signup'}\n\t\t\t\t\t\t\t\t<div class=\" mt-1 text-xs font-medium text-gray-500\">\n\t\t\t\t\t\t\t\t\tâ“˜ {$WEBUI_NAME}\n\t\t\t\t\t\t\t\t\t{$i18n.t(\n\t\t\t\t\t\t\t\t\t\t'does not make any external connections outside of GSA govcloud, and your data is stored securely on cloud.gov.'\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mb-1\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref=\"{WEBUI_BASE_URL}/authorize/cloudgov\"\n\t\t\t\t\t\t\t\tclass=\"inline-block bg-gray-900 hover:bg-gray-800 w-full rounded-2xl text-white font-medium text-sm py-3 transition text-center\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{'Sign in with Cloud.gov'}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mb-1\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref=\"{WEBUI_BASE_URL}/authorize/github\"\n\t\t\t\t\t\t\t\tclass=\"inline-block bg-gray-900 hover:bg-gray-800 w-full rounded-2xl text-white font-medium text-sm py-3 transition text-center\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{'Sign in with Github'}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n{/if}\n\n<style>\n\t.font-mona {\n\t\tfont-family: 'Mona Sans', -apple-system, 'Arimo', ui-sans-serif, system-ui, 'Segoe UI', Roboto,\n\t\t\tUbuntu, Cantarell, 'Noto Sans', sans-serif, 'Helvetica Neue', Arial, 'Apple Color Emoji',\n\t\t\t'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n\t}\n</style>\n"],"names":["WEBUI_BASE_URL","ctx","insert_hydration","target","div2","anchor","div4","append_hydration","div3","form","div1","div0","br","span","a0","a1","set_data","t0","t0_value","t2","t2_value","create_if_block","email","password","i18n","getContext","loaded","state","code","provider","setSessionUser","sessionUser","toast","$i18n","$socket","user","goto","signInHandler","userSignIn","error","signInHandlerOauth","userSignInOauth","$$invalidate","submitHandler","onMount","$user","params","$page","$config"],"mappings":"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"}