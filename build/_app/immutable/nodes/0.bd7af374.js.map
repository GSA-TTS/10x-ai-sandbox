{"version":3,"file":"0.bd7af374.js","sources":["../../../../../../src/routes/+layout.js","../../../../../../src/routes/+layout.svelte"],"sourcesContent":["// if you want to generate a static html file\n// for your page.\n// Documentation: https://kit.svelte.dev/docs/page-options#prerender\n// export const prerender = true;\n\n// if you want to Generate a SPA\n// you have to set ssr to false.\n// This is not the case (so set as true or comment the line)\n// Documentation: https://kit.svelte.dev/docs/page-options#ssr\nexport const ssr = false;\n\n// How to manage the trailing slashes in the URLs\n// the URL for about page witll be /about with 'ignore' (default)\n// the URL for about page witll be /about/ with 'always'\n// https://kit.svelte.dev/docs/page-options#trailingslash\nexport const trailingSlash = 'ignore';\n","<script>\n\timport { io } from 'socket.io-client';\n\timport { spring } from 'svelte/motion';\n\n\tlet loadingProgress = spring(0, {\n\t\tstiffness: 0.05\n\t});\n\n\timport { onMount, tick, setContext } from 'svelte';\n\timport {\n\t\tconfig,\n\t\tuser,\n\t\ttheme,\n\t\tWEBUI_NAME,\n\t\tmobile,\n\t\tsocket,\n\t\tactiveUserCount,\n\t\tUSAGE_POOL\n\t} from '$lib/stores';\n\timport { goto } from '$app/navigation';\n\timport { Toaster, toast } from 'svelte-sonner';\n\n\timport { getBackendConfig } from '$lib/apis';\n\timport { getSessionUser } from '$lib/apis/auths';\n\n\timport '../tailwind.css';\n\timport '../app.css';\n\n\timport 'tippy.js/dist/tippy.css';\n\n\timport { WEBUI_BASE_URL, WEBUI_HOSTNAME } from '$lib/constants';\n\timport i18n, { initI18n, getLanguages } from '$lib/i18n';\n\n\timport { page } from '$app/stores';\n\n\tconsole.log('Page URL:', $page.url);\n\t$: queryParams = $page.url.searchParams;\n\tif (queryParams) {\n\t\tconsole.log('Query Params from layout:', queryParams.toString());\n\t} else {\n\t\tconsole.log('No Query Params from layout');\n\t}\n\n\tsetContext('i18n', i18n);\n\n\tlet loaded = false;\n\tconst BREAKPOINT = 768;\n\n\tonMount(async () => {\n\t\ttheme.set(localStorage.theme);\n\n\t\tmobile.set(window.innerWidth < BREAKPOINT);\n\t\tconst onResize = () => {\n\t\t\tif (window.innerWidth < BREAKPOINT) {\n\t\t\t\tmobile.set(true);\n\t\t\t} else {\n\t\t\t\tmobile.set(false);\n\t\t\t}\n\t\t};\n\n\t\twindow.addEventListener('resize', onResize);\n\n\t\tlet backendConfig = null;\n\t\ttry {\n\t\t\tbackendConfig = await getBackendConfig();\n\t\t\tconsole.log('Backend config:', backendConfig);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error loading backend config:', error);\n\t\t}\n\t\t// Initialize i18n even if we didn't get a backend config,\n\t\t// so `/error` can show something that's not `undefined`.\n\n\t\tconst languages = await getLanguages();\n\n\t\tconst browserLanguage = navigator.languages\n\t\t\t? navigator.languages[0]\n\t\t\t: navigator.language || navigator.userLanguage;\n\n\t\tinitI18n(languages.includes(browserLanguage) ? browserLanguage : backendConfig?.default_locale);\n\n\t\tif (backendConfig) {\n\t\t\t// Save Backend Status to Store\n\t\t\tawait config.set(backendConfig);\n\t\t\tawait WEBUI_NAME.set(backendConfig.name);\n\n\t\t\tif ($config) {\n\t\t\t\tconst _socket = io(`${WEBUI_BASE_URL}`, {\n\t\t\t\t\treconnection: true,\n\t\t\t\t\treconnectionDelay: 1000,\n\t\t\t\t\treconnectionDelayMax: 5000,\n\t\t\t\t\trandomizationFactor: 0.5,\n\t\t\t\t\tpath: '/ws/socket.io',\n\t\t\t\t\tauth: { token: localStorage.token }\n\t\t\t\t});\n\n\t\t\t\tawait socket.set(_socket);\n\n\t\t\t\t// _socket.on('connect_error', (err) => {\n\t\t\t\t// \tconsole.log('connect_error', err);\n\t\t\t\t// });\n\n\t\t\t\t_socket.on('connect', () => {\n\t\t\t\t\tconsole.log('connected');\n\t\t\t\t});\n\n\t\t\t\t_socket.on('reconnect_attempt', (attempt) => {\n\t\t\t\t\tconsole.log('reconnect_attempt', attempt);\n\t\t\t\t});\n\n\t\t\t\t_socket.on('reconnect_failed', () => {\n\t\t\t\t\tconsole.log('reconnect_failed');\n\t\t\t\t});\n\n\t\t\t\t_socket.on('disconnect', (reason, details) => {\n\t\t\t\t\tconsole.log(`Socket ${_socket.id} disconnected due to ${reason}`);\n\t\t\t\t\tif (details) {\n\t\t\t\t\t\tconsole.log('Additional details:', details);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_socket.on('user-count', (data) => {\n\t\t\t\t\tconsole.log('user-count', data);\n\t\t\t\t\tactiveUserCount.set(data.count);\n\t\t\t\t});\n\n\t\t\t\t_socket.on('usage', (data) => {\n\t\t\t\t\tconsole.log('usage', data);\n\t\t\t\t\tUSAGE_POOL.set(data['models']);\n\t\t\t\t});\n\n\t\t\t\tif (localStorage.token) {\n\t\t\t\t\t// Get Session User Info\n\t\t\t\t\tconst sessionUser = await getSessionUser(localStorage.token).catch((error) => {\n\t\t\t\t\t\ttoast.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (sessionUser) {\n\t\t\t\t\t\t// Save Session User to Store\n\t\t\t\t\t\tawait user.set(sessionUser);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Redirect Invalid Session User to /auth Page\n\t\t\t\t\t\tlocalStorage.removeItem('token');\n\t\t\t\t\t\tconst currentParams = new URLSearchParams($page.url.search);\n\t\t\t\t\t\tawait goto(`/auth?${currentParams.toString()}`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst currentParams = new URLSearchParams($page.url.search);\n\t\t\t\t\tawait goto(`/auth?${currentParams.toString()}`);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Redirect to /error when Backend Not Detected\n\t\t\tawait goto(`/error`);\n\t\t}\n\n\t\tawait tick();\n\n\t\tif (\n\t\t\tdocument.documentElement.classList.contains('her') &&\n\t\t\tdocument.getElementById('progress-bar')\n\t\t) {\n\t\t\tloadingProgress.subscribe((value) => {\n\t\t\t\tconst progressBar = document.getElementById('progress-bar');\n\n\t\t\t\tif (progressBar) {\n\t\t\t\t\tprogressBar.style.width = `${value}%`;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tawait loadingProgress.set(100);\n\n\t\t\tdocument.getElementById('splash-screen')?.remove();\n\n\t\t\tconst audio = new Audio(`/audio/greeting.mp3`);\n\t\t\tconst playAudio = () => {\n\t\t\t\taudio.play();\n\t\t\t\tdocument.removeEventListener('click', playAudio);\n\t\t\t};\n\n\t\t\tdocument.addEventListener('click', playAudio);\n\n\t\t\tloaded = true;\n\t\t} else {\n\t\t\tdocument.getElementById('splash-screen')?.remove();\n\t\t\tloaded = true;\n\t\t}\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('resize', onResize);\n\t\t};\n\t});\n</script>\n\n<svelte:head>\n\t<title>{$WEBUI_NAME}</title>\n\t<link crossorigin=\"anonymous\" rel=\"icon\" href=\"{WEBUI_BASE_URL}/static/favicon.png\" />\n\n\t<!-- rosepine themes have been disabled as it's not up to date with our latest version. -->\n\t<!-- feel free to make a PR to fix if anyone wants to see it return -->\n\t<!-- <link rel=\"stylesheet\" type=\"text/css\" href=\"/themes/rosepine.css\" />\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/themes/rosepine-dawn.css\" /> -->\n</svelte:head>\n\n{#if loaded}\n\t<slot />\n{/if}\n\n<Toaster richColors position=\"top-center\" />\n"],"names":["ssr","trailingSlash","ctx","create_if_block","WEBUI_BASE_URL","append_hydration","document_1","link","BREAKPOINT","loadingProgress","spring","$page","queryParams","setContext","i18n","loaded","onMount","theme","mobile","onResize","backendConfig","getBackendConfig","error","languages","getLanguages","browserLanguage","initI18n","config","WEBUI_NAME","$config","_socket","io","socket","attempt","reason","details","data","activeUserCount","USAGE_POOL","sessionUser","getSessionUser","toast","user","currentParams","goto","tick","value","progressBar","_a","audio","playAudio","$$invalidate","_b"],"mappings":"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"}